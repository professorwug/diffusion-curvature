<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
    <meta charset="utf-8">
    <meta name="generator" content="quarto-1.5.55">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


    <title>Sign Prediction Tests</title>
    <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      div.columns{display: flex; gap: min(4vw, 1.5em);}
      div.column{flex: auto; overflow-x: auto;}
      div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
      ul.task-list{list-style: none;}
      ul.task-list li input[type="checkbox"] {
        width: 0.8em;
        margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
        vertical-align: middle;
      }
      /* CSS for syntax highlighting */
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
        }
      pre.numberSource { margin-left: 3em;  padding-left: 4px; }
      div.sourceCode
        {   }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
    </style>

    <style>
      body.hypothesis-enabled #quarto-embed-header {
        padding-right: 36px;
      }

      #quarto-embed-header {
        height: 3em;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: solid 1px;
      }

      #quarto-embed-header h6 {
        font-size: 1.1em;
        padding-top: 0.6em;
        margin-left: 1em;
        margin-right: 1em;
        font-weight: 400;
      }

      #quarto-embed-header a.quarto-back-link,
      #quarto-embed-header a.quarto-download-embed {
        font-size: 0.8em;
        margin-top: 1em;
        margin-bottom: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }

      .quarto-back-container {
        padding-left: 0.5em;
        display: flex;
      }

      .headroom {
          will-change: transform;
          transition: transform 200ms linear;
      }

      .headroom--pinned {
          transform: translateY(0%);
      }

      .headroom--unpinned {
          transform: translateY(-100%);
      }      
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script>
    window.document.addEventListener("DOMContentLoaded", function () {

      var header = window.document.querySelector("#quarto-embed-header");
      const titleBannerEl = window.document.querySelector("body > #title-block-header");
      if (titleBannerEl) {
        titleBannerEl.style.paddingTop = header.clientHeight + "px";
      }
      const contentEl = window.document.getElementById('quarto-content');
      for (const child of contentEl.children) {
        child.style.paddingTop = header.clientHeight + "px";
        child.style.marginTop = "1em";
      }

      // Use the article root if the `back` call doesn't work. This isn't perfect
      // but should typically work
      window.quartoBackToArticle = () => {
        var currentUrl = window.location.href;
        window.history.back();
        setTimeout(() => {
            // if location was not changed in 100 ms, then there is no history back
            if(currentUrl === window.location.href){              
                // redirect to site root
                window.location.href = "../paper/index.html";
            }
        }, 100);
      }

      const headroom = new window.Headroom(header, {
        tolerance: 5,
        onPin: function () {
        },
        onUnpin: function () {
        },
      });
      headroom.init();
    });
    </script>

    
<script src="../paper/site_libs/manuscript-notebook/headroom.min.js"></script>
<script src="../paper/site_libs/clipboard/clipboard.min.js"></script>
<script src="../paper/site_libs/quarto-html/quarto.js"></script>
<script src="../paper/site_libs/quarto-html/popper.min.js"></script>
<script src="../paper/site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../paper/site_libs/quarto-html/anchor.min.js"></script>
<link href="../paper/site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../paper/site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../paper/site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../paper/site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../paper/site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../paper/site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../paper/site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../paper/site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
     <script async="" src="https://hypothes.is/embed.js"></script>
<script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script>  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>  
      </head>

  <body class="quarto-notebook">
    <div id="quarto-embed-header" class="headroom fixed-top bg-primary">
      
      <a onclick="window.quartoBackToArticle(); return false;" class="btn btn-primary quarto-back-link" href=""><i class="bi bi-caret-left"></i> Back to Article</a>
      <h6><i class="bi bi-journal-code"></i> Standard libraries</h6>

            <a href="../paper/nbs/5-sign-prediction-tests.ipynb" class="btn btn-primary quarto-download-embed" download="5-sign-prediction-tests.ipynb">Download Notebook</a>
          </div>

     <header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Sign Prediction Tests</h1>
          </div>

    
    <div class="quarto-title-meta-container">
      <div class="quarto-title-meta-column-start">
        
        <div class="quarto-title-meta">

                
          
                
              </div>
      </div>
      <div class="quarto-title-meta-column-end quarto-other-formats-target">
      </div>
    </div>



    <div class="quarto-other-links-text-target">
    </div>  </div>
</header><div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#machinery" id="toc-machinery" class="nav-link active" data-scroll-target="#machinery">Machinery</a></li>
  <li><a href="#parameter-optimization" id="toc-parameter-optimization" class="nav-link" data-scroll-target="#parameter-optimization">Parameter Optimization</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content quarto-banner-title-block" id="quarto-document-content">      

       <p>::: {#cell-1 .cell 0=‘d’ 1=‘e’ 2=‘f’ 3=‘a’ 4=‘u’ 5=‘l’ 6=‘t’ 7=‘<em>’ 8=’e’ 9=’x’ 10=’p’ 11=’ ’ 12=’b’ 13=’e’ 14=’n’ 15=’c’ 16=’h’ 17=’m’ 18=’a’ 19=’r’ 20=’k’ 21=’i’ 22=’n’ 23=’g’ 24=’.’ 25=’s’ 26=’i’ 27=’g’ 28=’n’ 29=’</em>’ 30=‘p’ 31=‘r’ 32=‘e’ 33=‘d’ 34=‘i’ 35=‘c’ 36=‘t’ 37=‘i’ 38=‘o’ 39=‘n’ 40=’ ’ 41=‘h’ 42=‘i’ 43=‘d’ 44=‘e’ execution_count=1}</p>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">## Standard libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nbdev.showdoc <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Configure environment</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'XLA_PYTHON_CLIENT_PREALLOCATE'</span>]<span class="op">=</span><span class="st">'false'</span> <span class="co"># Tells Jax not to hog all of the memory to this process.</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> nest_asyncio</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>nest_asyncio.<span class="bu">apply</span>()</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">## Imports for plotting</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>matplotlib inline</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># set_matplotlib_formats('svg', 'pdf') # For export</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> to_rgba</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">## Progress bar</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm, trange</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">## project specifics</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> diffusion_curvature</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygsp</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.graphs <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.datasets <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.utils <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co"># from diffusion_curvature.comparison_space import *</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.sadspheres <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.kernels <span class="im">import</span> <span class="op">*</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>load_ext autoreload</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>autoreload <span class="dv">2</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>jax.devices()</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># jax.default_device = jax.devices("cpu")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[1], line 31</span>
<span class="ansi-green-fg ansi-bold">     28</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span> <span style="font-weight:bold;color:rgb(0,0,255)">functools</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> partial
<span class="ansi-green-fg ansi-bold">     30</span> <span style="font-style:italic;color:rgb(95,135,135)">## project specifics</span>
<span class="ansi-green-fg">---&gt; 31</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> <span style="font-weight:bold;color:rgb(0,0,255)">diffusion_curvature</span>
<span class="ansi-green-fg ansi-bold">     32</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> <span style="font-weight:bold;color:rgb(0,0,255)">pygsp</span>
<span class="ansi-green-fg ansi-bold">     33</span> <span style="font-weight:bold;color:rgb(0,135,0)">import</span> <span style="font-weight:bold;color:rgb(0,0,255)">jax</span>

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named 'diffusion_curvature'</pre>
</div>
</div>
<p>:::</p>
<blockquote class="blockquote">
<p>Comparisons between Diffusion Curvature and the Competition</p>
</blockquote>
<p>Here we employ saddles and spheres of increasing dimension to test our model’s ability to detect sign.</p>
<section id="machinery" class="level1">
<h1>Machinery</h1>
<p>::: {#cell-5 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’}</p>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>num_pointclouds <span class="op">=</span> <span class="dv">20</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<p>::: {#cell-6 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’}</p>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm, trange</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> diffusion_curvature</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygsp</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.graphs <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.datasets <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.utils <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># from diffusion_curvature.comparison_space import *</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.sadspheres <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.kernels <span class="im">import</span> <span class="op">*</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.kernels <span class="im">import</span> tune_curvature_agnostic_kernel</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>method_name <span class="op">=</span> <span class="st">"Diffusion Curvature"</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> run_sadspheres(</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    SS1 <span class="op">=</span> SadSpheres(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>        dimension <span class="op">=</span> dims, <span class="co"># Dimension of saddles and spheres</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>        num_pointclouds <span class="op">=</span> num_pointclouds, <span class="co"># num pointclouds to make in total</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>        num_points <span class="op">=</span> <span class="dv">2000</span>, <span class="co"># num points per pointclouds</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>        noise_level <span class="op">=</span> <span class="dv">0</span>, <span class="co"># from 0 to 1. 1 is all noise.</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>        include_planes<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    known_dim_bandwidths <span class="op">=</span> {}</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> method_name <span class="kw">in</span> SS1.imported_methods:</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> SS1</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> X <span class="kw">in</span> tqdm(SS1):</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>        dim <span class="op">=</span> X.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> dim <span class="kw">not</span> <span class="kw">in</span> known_dim_bandwidths.keys():</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>            kernel, ns <span class="op">=</span> tune_curvature_agnostic_kernel(X, <span class="dv">120</span>, tolerance <span class="op">=</span> <span class="dv">5</span>, max_iterations <span class="op">=</span> <span class="dv">100</span>, alpha <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>            known_dim_bandwidths[dim] <span class="op">=</span> kernel</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>        DC <span class="op">=</span> DiffusionCurvature2(</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>            graph_former <span class="op">=</span> known_dim_bandwidths[dim],</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>            comparison_space_trials <span class="op">=</span> <span class="dv">10</span>,</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>        ks <span class="op">=</span> DC.fit(X, dim <span class="op">=</span> X.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, idx <span class="op">=</span> <span class="dv">0</span>, ts <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">84</span>)))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>        SS1.update(ks.item(), method_name <span class="op">=</span> method_name)</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    SS1.save_results()</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> SS1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [1]:</pre></div><div id="cell-7" class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>SS1 <span class="op">=</span> run_sadspheres()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Loaded evaluations on methods ['ground truth', 'Diffusion Curvature (Entropic)', 'Diffusion Curvature (Wasserstein)', 'Hickok &amp; Blumberg', 'Diffusion Curvature (Trajectory Normalized w/ Anisotropy)', 'Diffusion Curvature (Trajectory Normalized w/ Smaller Bandwidth)', 'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 18 t 84)', 'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 40 t 84)', 'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 80 t 84)', 'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 120 t 84)', 'Diffusion Curvature (TN w/ ca n 120 t 84 trials 10)']</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"502b4f04e55f4c29b3e39299149bff3b","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [2]:</pre></div><div id="cell-8" class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>to_delete <span class="op">=</span> [<span class="st">'Diffusion Curvature (Trajectory Normalized w/ Anisotropy)'</span>, <span class="st">'Diffusion Curvature (Trajectory Normalized w/ Smaller Bandwidth)'</span>, <span class="st">'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 18 t 84)'</span>, <span class="st">'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 40 t 84)'</span>, <span class="st">'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 80 t 84)'</span>, <span class="st">'Diffusion Curvature (TN w/ k = 1 consistent adaptive n 120 t 84)'</span>, <span class="st">'Diffusion Curvature (TN w/ ca n 120 t 84 trials 10)'</span>, <span class="st">'Diffusion Curvature (Entropic)'</span>, <span class="st">'Diffusion Curvature (Wasserstein)'</span>]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name <span class="kw">in</span> to_delete:</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    SS1.delete_saved_method(name)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>SS1.save_results()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Deleted method from saved results
Deleted method from saved results
Deleted method from saved results
Deleted method from saved results
Deleted method from saved results
Deleted method from saved results
Deleted method from saved results
Deleted method from saved results
Deleted method from saved results</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [3]:</pre></div><div id="cell-9" class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>SS1.table()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>ks
                     pearson_r  sign_score
ground truth          1.000000       1.000
Hickok &amp; Blumberg     0.031123       0.600
Diffusion Curvature   0.754211       0.965</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>{'ks':                      pearson_r  sign_score
 ground truth          1.000000       1.000
 Hickok &amp; Blumberg     0.031123       0.600
 Diffusion Curvature   0.754211       0.965}</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [4]:</pre></div><div id="cell-fig-sadspheres" class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>SS1._aggregate_labels()</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>SS1.plot_by_dimension()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<div id="fig-sadspheres" class="quarto-float quarto-figure quarto-figure-center anchored" alt="...">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-sadspheres-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="">
<a href="5-sign-prediction-tests_files/figure-html/fig-sadspheres-output-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure&nbsp;1: Predicted curvatures of Saddles and Spheres in dimensions 2-6. Diffusion Curvature robustly distinguishes between the signs of the data, even in high dimensions, and with relative sparsity."><img src="5-sign-prediction-tests_files/figure-html/fig-sadspheres-output-1.png" class="img-fluid figure-img" alt="..."></a>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sadspheres-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Predicted curvatures of Saddles and Spheres in dimensions 2-6. Diffusion Curvature robustly distinguishes between the signs of the data, even in high dimensions, and with relative sparsity.
</figcaption>
</figure>
</div>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [5]:</pre></div><div id="cell-11" class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>SS1.metric_tables[<span class="st">'ks'</span>][SS1.metric_tables[<span class="st">'ks'</span>].keys()[<span class="dv">0</span>]][<span class="st">'ground truth'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>1.0</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [6]:</pre></div><div id="cell-12" class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>SS1.get_score(<span class="st">'Hickok &amp; Blumberg'</span>, <span class="st">'pearson_r'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.0311233206615215</code></pre>
</div>
</div></div>
<div class="cell-container"><div class="cell-decorator"><pre>In [7]:</pre></div><div id="cell-13" class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># graph_former = partial(get_curvature_agnostic_graph, k = dim*2, )</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.kernels <span class="im">import</span> tune_curvature_agnostic_kernel</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>graph_former <span class="op">=</span> partial(get_fixed_graph, sigma <span class="op">=</span> <span class="fl">0.2</span>, alpha <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> X <span class="kw">in</span> tqdm(SS1):</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"Diffusion Curvature (Entropic)"</span> <span class="kw">not</span> <span class="kw">in</span> SS1.imported_methods:</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>        G <span class="op">=</span> graph_former(X)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>        DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>            laziness_method<span class="op">=</span><span class="st">"Wasserstein"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>            flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>            comparison_method<span class="op">=</span><span class="st">"Ollivier"</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>            graph_former <span class="op">=</span> graph_former,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>            points_per_cluster<span class="op">=</span><span class="va">None</span>,  <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>            comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        ks <span class="op">=</span> DC.curvature(G, dim <span class="op">=</span> X.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, t <span class="op">=</span> <span class="dv">25</span>)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        SS1.update(ks[<span class="dv">0</span>], method_name<span class="op">=</span><span class="st">"Diffusion Curvature (Entropic)"</span>)</span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"Diffusion Curvature (Wasserstein)"</span> <span class="kw">not</span> <span class="kw">in</span> SS1.imported_methods:</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        G <span class="op">=</span> graph_former(X)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>            laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>            flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>            comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            graph_former <span class="op">=</span> graph_former,</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>            points_per_cluster<span class="op">=</span><span class="va">None</span>,  <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>            comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        ks <span class="op">=</span> DC.curvature(G, dim <span class="op">=</span> X.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, t <span class="op">=</span> <span class="dv">25</span>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        SS1.update(ks[<span class="dv">0</span>], method_name<span class="op">=</span><span class="st">"Diffusion Curvature (Wasserstein)"</span>)</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">"Diffusion Curvature (TN w/ k = 1 adaptive n t 40)"</span> <span class="kw">not</span> <span class="kw">in</span> SS1.imported_methods:</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>        kernel, ns <span class="op">=</span> tune_curvature_agnostic_kernel(X, <span class="dv">20</span>, tolerance <span class="op">=</span> <span class="dv">5</span>)</span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>        DC <span class="op">=</span> DiffusionCurvature2(</span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>            graph_former <span class="op">=</span> kernel</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        ks <span class="op">=</span> DC.fit(X, dim <span class="op">=</span> X.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, idx <span class="op">=</span> <span class="dv">0</span>, ts <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">40</span>)))</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>        SS1.update(ks.item(), method_name <span class="op">=</span> <span class="st">"Diffusion Curvature (TN w/ k = 1 n = 1 t 39 a 0.9)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"cca41d03f31b45a583d7a059b31bd630","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[8], line 30</span>
<span class="ansi-green-fg ansi-bold">     28</span>     SS1<span style="color:rgb(98,98,98)">.</span>update(ks[<span style="color:rgb(98,98,98)">0</span>], method_name<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Diffusion Curvature (Wasserstein)</span><span style="color:rgb(175,0,0)">"</span>)
<span class="ansi-green-fg ansi-bold">     29</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Diffusion Curvature (TN w/ k = 1 adaptive n t 40)</span><span style="color:rgb(175,0,0)">"</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(175,0,255)">in</span> SS1<span style="color:rgb(98,98,98)">.</span>imported_methods:
<span class="ansi-green-fg">---&gt; 30</span>     kernel, ns <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">tune_curvature_agnostic_kernel</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">20</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">tolerance</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">5</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">     31</span>     DC <span style="color:rgb(98,98,98)">=</span> DiffusionCurvature2(
<span class="ansi-green-fg ansi-bold">     32</span>         graph_former <span style="color:rgb(98,98,98)">=</span> kernel
<span class="ansi-green-fg ansi-bold">     33</span>     )
<span class="ansi-green-fg ansi-bold">     34</span>     ks <span style="color:rgb(98,98,98)">=</span> DC<span style="color:rgb(98,98,98)">.</span>fit(X, dim <span style="color:rgb(98,98,98)">=</span> X<span style="color:rgb(98,98,98)">.</span>shape[<span style="color:rgb(98,98,98)">1</span>] <span style="color:rgb(98,98,98)">-</span> <span style="color:rgb(98,98,98)">1</span>, idx <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">0</span>, ts <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(<span style="color:rgb(0,135,0)">range</span>(<span style="color:rgb(98,98,98)">1</span>,<span style="color:rgb(98,98,98)">40</span>)))

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:239</span>, in <span class="ansi-cyan-fg">tune_curvature_agnostic_kernel</span><span class="ansi-blue-fg">(X, num_in_first_scale, tolerance, eps, max_iterations, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    237</span> total_runs <span style="color:rgb(98,98,98)">+</span><span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">1</span>
<span class="ansi-green-fg ansi-bold">    238</span> ns <span style="color:rgb(98,98,98)">=</span> (lower_bound <span style="color:rgb(98,98,98)">+</span> upper_bound) <span style="color:rgb(98,98,98)">/</span> <span style="color:rgb(98,98,98)">2</span>
<span class="ansi-green-fg">--&gt; 239</span> num, kernel <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">try_kernel_with_neighbor_scale</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ns</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    241</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> num <span style="color:rgb(98,98,98)">&gt;</span> num_in_first_scale:
<span class="ansi-green-fg ansi-bold">    242</span>         upper_bound <span style="color:rgb(98,98,98)">=</span> ns

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:226</span>, in <span class="ansi-cyan-fg">tune_curvature_agnostic_kernel.&lt;locals&gt;.try_kernel_with_neighbor_scale</span><span class="ansi-blue-fg">(X, ns, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    224</span> kernel <span style="color:rgb(98,98,98)">=</span> partial(get_curvature_agnostic_graph, neighbor_scale <span style="color:rgb(98,98,98)">=</span> ns, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg ansi-bold">    225</span> G <span style="color:rgb(98,98,98)">=</span> kernel(X)
<span class="ansi-green-fg">--&gt; 226</span> P <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">diffusion_matrix_from_graph</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">G</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    227</span> num <span style="color:rgb(98,98,98)">=</span> num_in_first_scale_of_diffusion(P, eps)
<span class="ansi-green-fg ansi-bold">    228</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> num, kernel

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:206</span>, in <span class="ansi-cyan-fg">diffusion_matrix_from_graph</span><span class="ansi-blue-fg">(G)</span>
<span class="ansi-green-fg ansi-bold">    203</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">diffusion_matrix_from_graph</span>(
<span class="ansi-green-fg ansi-bold">    204</span>         G
<span class="ansi-green-fg ansi-bold">    205</span> ):
<span class="ansi-green-fg">--&gt; 206</span>     <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">diffusion_matrix_from_affinities</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">G</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">W</span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:198</span>, in <span class="ansi-cyan-fg">diffusion_matrix_from_affinities</span><span class="ansi-blue-fg">(W)</span>
<span class="ansi-green-fg ansi-bold">    195</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">diffusion_matrix_from_affinities</span>(
<span class="ansi-green-fg ansi-bold">    196</span>         W
<span class="ansi-green-fg ansi-bold">    197</span> ):
<span class="ansi-green-fg">--&gt; 198</span>     W <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">W</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">+</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">jnp</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">eye</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">len</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">W</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">1e-8</span>
<span class="ansi-green-fg ansi-bold">    199</span>     D <span style="color:rgb(98,98,98)">=</span> jnp<span style="color:rgb(98,98,98)">.</span>diag(<span style="color:rgb(98,98,98)">1</span><span style="color:rgb(98,98,98)">/</span>jnp<span style="color:rgb(98,98,98)">.</span>sum(W,axis<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(98,98,98)">1</span>))
<span class="ansi-green-fg ansi-bold">    200</span>     P <span style="color:rgb(98,98,98)">=</span> D <span style="color:rgb(98,98,98)">@</span> W

File <span class="ansi-green-fg">~/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/jax/_src/numpy/array_methods.py:271</span>, in <span class="ansi-cyan-fg">_defer_to_unrecognized_arg.&lt;locals&gt;.deferring_binary_op</span><span class="ansi-blue-fg">(self, other)</span>
<span class="ansi-green-fg ansi-bold">    269</span> args <span style="color:rgb(98,98,98)">=</span> (other, <span style="color:rgb(0,135,0)">self</span>) <span style="font-weight:bold;color:rgb(0,135,0)">if</span> swap <span style="font-weight:bold;color:rgb(0,135,0)">else</span> (<span style="color:rgb(0,135,0)">self</span>, other)
<span class="ansi-green-fg ansi-bold">    270</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">isinstance</span>(other, _accepted_binop_types):
<span class="ansi-green-fg">--&gt; 271</span>   <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">binary_op</span><span class="ansi-yellow-bg">(</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    272</span> <span style="font-style:italic;color:rgb(95,135,135)"># Note: don't use isinstance here, because we don't want to raise for</span>
<span class="ansi-green-fg ansi-bold">    273</span> <span style="font-style:italic;color:rgb(95,135,135)"># subclasses, e.g. NamedTuple objects that may override operators.</span>
<span class="ansi-green-fg ansi-bold">    274</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="color:rgb(0,135,0)">type</span>(other) <span style="font-weight:bold;color:rgb(175,0,255)">in</span> _rejected_binop_types:

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>
</div></div>
</section>
<section id="parameter-optimization" class="level1">
<h1>Parameter Optimization</h1>
<p>::: {#cell-15 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’}</p>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> optuna</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> time</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> fastcore.<span class="bu">all</span> <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nbdev.showdoc <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">## Imports for plotting</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> set_matplotlib_formats</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># set_matplotlib_formats('svg', 'pdf') # For export</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.colors <span class="im">import</span> to_rgba</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>sns.<span class="bu">set</span>()</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co">## Progress bar</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tqdm.auto <span class="im">import</span> tqdm, trange</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> partial</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">## project specifics</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> diffusion_curvature</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pygsp</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax</span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> jax.numpy <span class="im">as</span> jnp</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.graphs <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.datasets <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.core <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.utils <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co"># from diffusion_curvature.comparison_space import *</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.sadspheres <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.kernels <span class="im">import</span> <span class="op">*</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>dims <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>]</span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>num_pointclouds <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the objective function for Optuna</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> objective(trial):</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define the hyperparameter search space</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>    params <span class="op">=</span> {</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'laziness_method': trial.suggest_categorical('laziness_method', ['Entropic']),</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        <span class="st">'anisotropy'</span>: trial.suggest_float(<span class="st">'anisotropy'</span>, <span class="dv">0</span>, <span class="dv">1</span>, step <span class="op">=</span> <span class="fl">0.1</span>),</span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'k' : trial.suggest_int('k', 1, 10),</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a>        <span class="co"># 'neighbor_scale': trial.suggest_int('neighbor_scale', 1, 20),</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a>        <span class="st">'max_t'</span>:trial.suggest_int(<span class="st">'max_t'</span>, <span class="dv">10</span>, <span class="dv">100</span>),</span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a>        <span class="st">'size_of_first_scale'</span>: trial.suggest_int(<span class="st">'size_of_first_scale'</span>, <span class="dv">3</span>, <span class="dv">50</span>),</span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a>        <span class="st">'tolerance'</span>: trial.suggest_int(<span class="st">'tolerance'</span>,<span class="dv">1</span>, <span class="dv">10</span>),</span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a>    SS1 <span class="op">=</span> SadSpheres(</span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a>        dimension <span class="op">=</span> dims, <span class="co"># Dimension of saddles and spheres</span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a>        num_pointclouds <span class="op">=</span> num_pointclouds, <span class="co"># num pointclouds to make in total</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a>        num_points <span class="op">=</span> <span class="dv">2000</span>, <span class="co"># num points per pointclouds</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a>        noise_level <span class="op">=</span> <span class="dv">0</span>, <span class="co"># from 0 to 1. 1 is all noise.</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a>        include_planes<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb17-57"><a href="#cb17-57" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-58"><a href="#cb17-58" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"index is "</span>, SS1.idx)</span>
<span id="cb17-59"><a href="#cb17-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> X <span class="kw">in</span> tqdm(SS1):</span>
<span id="cb17-60"><a href="#cb17-60" aria-hidden="true" tabindex="-1"></a>        kernel, ns <span class="op">=</span> tune_curvature_agnostic_kernel(X, params[<span class="st">'size_of_first_scale'</span>], tolerance <span class="op">=</span> params[<span class="st">'tolerance'</span>], max_iterations <span class="op">=</span> <span class="dv">100</span>, alpha <span class="op">=</span> params[<span class="st">'anisotropy'</span>])</span>
<span id="cb17-61"><a href="#cb17-61" aria-hidden="true" tabindex="-1"></a>        DC <span class="op">=</span> DiffusionCurvature2(</span>
<span id="cb17-62"><a href="#cb17-62" aria-hidden="true" tabindex="-1"></a>            graph_former <span class="op">=</span> kernel</span>
<span id="cb17-63"><a href="#cb17-63" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-64"><a href="#cb17-64" aria-hidden="true" tabindex="-1"></a>        ks <span class="op">=</span> DC.fit(X, dim <span class="op">=</span> X.shape[<span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, idx <span class="op">=</span> <span class="dv">0</span>, ts <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">1</span>,params[<span class="st">'max_t'</span>])))</span>
<span id="cb17-65"><a href="#cb17-65" aria-hidden="true" tabindex="-1"></a>        SS1.update(ks.item(), method_name <span class="op">=</span> <span class="st">"Diffusion Curvature 2 Optuna"</span>)</span>
<span id="cb17-66"><a href="#cb17-66" aria-hidden="true" tabindex="-1"></a>    score <span class="op">=</span> SS1.get_score(<span class="st">'Diffusion Curvature 2 Optuna'</span>, <span class="st">'sign_score'</span>)</span>
<span id="cb17-67"><a href="#cb17-67" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-68"><a href="#cb17-68" aria-hidden="true" tabindex="-1"></a>    SS1.delete_saved_method(<span class="st">'Diffusion Curvature 2 Optuna'</span>)</span>
<span id="cb17-69"><a href="#cb17-69" aria-hidden="true" tabindex="-1"></a>    SS1.save_results()</span>
<span id="cb17-70"><a href="#cb17-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> score</span>
<span id="cb17-71"><a href="#cb17-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-72"><a href="#cb17-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-73"><a href="#cb17-73" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> optimize_parameters():</span>
<span id="cb17-74"><a href="#cb17-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create a study object and specify TPE as the sampler</span></span>
<span id="cb17-75"><a href="#cb17-75" aria-hidden="true" tabindex="-1"></a>    study <span class="op">=</span> optuna.create_study(direction<span class="op">=</span><span class="st">'maximize'</span>, sampler<span class="op">=</span>optuna.samplers.TPESampler())</span>
<span id="cb17-76"><a href="#cb17-76" aria-hidden="true" tabindex="-1"></a>    study.optimize(objective, n_trials<span class="op">=</span><span class="dv">50</span>)</span>
<span id="cb17-77"><a href="#cb17-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-78"><a href="#cb17-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the best hyperparameters and the best score</span></span>
<span id="cb17-79"><a href="#cb17-79" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Best hyperparameters: "</span>, study.best_params)</span>
<span id="cb17-80"><a href="#cb17-80" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Best score: "</span>, study.best_value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [8]:</pre></div><div id="cell-16" class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># testing</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>optimize_parameters()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>[I 2024-07-29 10:34:23,442] A new study created in memory with name: no-name-cfe3d17f-e484-470b-babf-19e97172b0b0</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Loaded evaluations on methods ['ground truth', 'Diffusion Curvature (Entropic)', 'Diffusion Curvature (Wasserstein)', 'Hickok &amp; Blumberg', 'Diffusion Curvature (Trajectory Normalized w/ Anisotropy)', 'Diffusion Curvature (Trajectory Normalized w/ Smaller Bandwidth)', 'Diffusion Curvature (Trajectory Normalized w/ Smaller Bandwidth, Many ts)', 'Diffusion Curvature (Trajectory Normalized w/ Smaller Bandwidth, Many more ts)', 'Diffusion Curvature (Trajectory Normalized w/ fixed kernel)', 'Diffusion Curvature (TN w/ k = 1 n = 2 t 120)', 'Diffusion Curvature (TN w/ k = 1 n = 3 t 80)', 'Diffusion Curvature (TN w/ k = 1 n = 1 t 39 a 0.9)', 'Diffusion Curvature (TN w/ k = 1 adaptive n t 40)', 'Diffusion Curvature (TN w/ k = 1 adaptive n 10 t 40)']
index is  -1</code></pre>
</div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7c1296a29c114882bbbcf7e32309c3c4","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>[W 2024-07-29 10:34:29,895] Trial 0 failed with parameters: {'max_t': 24, 'size_of_first_scale': 13, 'tolerance': 1} because of the following error: KeyboardInterrupt().
Traceback (most recent call last):
  File "/home/piriac/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/optuna/study/_optimize.py", line 196, in _run_trial
    value_or_values = func(trial)
                      ^^^^^^^^^^^
  File "/tmp/ipykernel_1546995/852392118.py", line 61, in objective
    kernel, ns = tune_curvature_agnostic_kernel(X, params['size_of_first_scale'], tolerance = params['tolerance'], max_iterations = 100)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/piriac/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py", line 240, in tune_curvature_agnostic_kernel
    num, kernel = try_kernel_with_neighbor_scale(X, ns, **kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/piriac/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py", line 226, in try_kernel_with_neighbor_scale
    G = kernel(X)
        ^^^^^^^^^
  File "/home/piriac/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py", line 114, in get_curvature_agnostic_graph
    G = SimpleGraph(W)
        ^^^^^^^^^^^^^^
  File "&lt;string&gt;", line 2, in __init__
KeyboardInterrupt
[W 2024-07-29 10:34:29,897] Trial 0 failed with value None.</code></pre>
</div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[20], line 2</span>
<span class="ansi-green-fg ansi-bold">      1</span> <span style="font-style:italic;color:rgb(95,135,135)"># testing</span>
<span class="ansi-green-fg">----&gt; 2</span> <span class="ansi-yellow-bg">optimize_parameters</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>

Cell <span class="ansi-green-fg">In[19], line 77</span>, in <span class="ansi-cyan-fg">optimize_parameters</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg ansi-bold">     74</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">optimize_parameters</span>():
<span class="ansi-green-fg ansi-bold">     75</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Create a study object and specify TPE as the sampler</span>
<span class="ansi-green-fg ansi-bold">     76</span>     study <span style="color:rgb(98,98,98)">=</span> optuna<span style="color:rgb(98,98,98)">.</span>create_study(direction<span style="color:rgb(98,98,98)">=</span><span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">maximize</span><span style="color:rgb(175,0,0)">'</span>, sampler<span style="color:rgb(98,98,98)">=</span>optuna<span style="color:rgb(98,98,98)">.</span>samplers<span style="color:rgb(98,98,98)">.</span>TPESampler())
<span class="ansi-green-fg">---&gt; 77</span>     <span class="ansi-yellow-bg">study</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">optimize</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">objective</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">n_trials</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">50</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">     79</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Print the best hyperparameters and the best score</span>
<span class="ansi-green-fg ansi-bold">     80</span>     <span style="color:rgb(0,135,0)">print</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Best hyperparameters: </span><span style="color:rgb(175,0,0)">"</span>, study<span style="color:rgb(98,98,98)">.</span>best_params)

File <span class="ansi-green-fg">~/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/optuna/study/study.py:451</span>, in <span class="ansi-cyan-fg">Study.optimize</span><span class="ansi-blue-fg">(self, func, n_trials, timeout, n_jobs, catch, callbacks, gc_after_trial, show_progress_bar)</span>
<span class="ansi-green-fg ansi-bold">    348</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">optimize</span>(
<span class="ansi-green-fg ansi-bold">    349</span>     <span style="color:rgb(0,135,0)">self</span>,
<span class="ansi-green-fg ansi-bold">    350</span>     func: ObjectiveFuncType,
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    357</span>     show_progress_bar: <span style="color:rgb(0,135,0)">bool</span> <span style="color:rgb(98,98,98)">=</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>,
<span class="ansi-green-fg ansi-bold">    358</span> ) <span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">&gt;</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>:
<span class="ansi-green-fg ansi-bold">    359</span> <span style="color:rgb(188,188,188)">    </span><span style="font-style:italic;color:rgb(175,0,0)">"""Optimize an objective function.</span>
<span class="ansi-green-fg ansi-bold">    360</span> 
<span class="ansi-green-fg ansi-bold">    361</span> <span style="font-style:italic;color:rgb(175,0,0)">    Optimization is done by choosing a suitable set of hyperparameter values from a given</span>
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-fg ansi-bold">    449</span> <span style="font-style:italic;color:rgb(175,0,0)">            If nested invocation of this method occurs.</span>
<span class="ansi-green-fg ansi-bold">    450</span> <span style="font-style:italic;color:rgb(175,0,0)">    """</span>
<span class="ansi-green-fg">--&gt; 451</span>     <span class="ansi-yellow-bg">_optimize</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">    452</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">study</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    453</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">func</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    454</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">n_trials</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">n_trials</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    455</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">timeout</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    456</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">n_jobs</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">n_jobs</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    457</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">catch</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">tuple</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">catch</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">if</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(0,135,0)" class="ansi-yellow-bg">isinstance</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">catch</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">Iterable</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg"> </span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">else</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">catch</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    458</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">callbacks</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">callbacks</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    459</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">gc_after_trial</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">gc_after_trial</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    460</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">show_progress_bar</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">show_progress_bar</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">    461</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">)</span>

File <span class="ansi-green-fg">~/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/optuna/study/_optimize.py:62</span>, in <span class="ansi-cyan-fg">_optimize</span><span class="ansi-blue-fg">(study, func, n_trials, timeout, n_jobs, catch, callbacks, gc_after_trial, show_progress_bar)</span>
<span class="ansi-green-fg ansi-bold">     60</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg ansi-bold">     61</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> n_jobs <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">1</span>:
<span class="ansi-green-fg">---&gt; 62</span>         <span class="ansi-yellow-bg">_optimize_sequential</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-fg ansi-bold">     63</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">study</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     64</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     65</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">n_trials</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     66</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">timeout</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     67</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">catch</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     68</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">callbacks</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     69</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">gc_after_trial</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     70</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">reseed_sampler_rng</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">False</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     71</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">time_start</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span style="font-weight:bold;color:rgb(0,135,0)" class="ansi-yellow-bg">None</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     72</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">progress_bar</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">progress_bar</span><span class="ansi-yellow-bg">,</span>
<span class="ansi-green-fg ansi-bold">     73</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">     74</span>     <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">     75</span>         <span style="font-weight:bold;color:rgb(0,135,0)">if</span> n_jobs <span style="color:rgb(98,98,98)">==</span> <span style="color:rgb(98,98,98)">-</span><span style="color:rgb(98,98,98)">1</span>:

File <span class="ansi-green-fg">~/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/optuna/study/_optimize.py:159</span>, in <span class="ansi-cyan-fg">_optimize_sequential</span><span class="ansi-blue-fg">(study, func, n_trials, timeout, catch, callbacks, gc_after_trial, reseed_sampler_rng, time_start, progress_bar)</span>
<span class="ansi-green-fg ansi-bold">    156</span>         <span style="font-weight:bold;color:rgb(0,135,0)">break</span>
<span class="ansi-green-fg ansi-bold">    158</span> <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 159</span>     frozen_trial <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">_run_trial</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">study</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">catch</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    160</span> <span style="font-weight:bold;color:rgb(0,135,0)">finally</span>:
<span class="ansi-green-fg ansi-bold">    161</span>     <span style="font-style:italic;color:rgb(95,135,135)"># The following line mitigates memory problems that can be occurred in some</span>
<span class="ansi-green-fg ansi-bold">    162</span>     <span style="font-style:italic;color:rgb(95,135,135)"># environments (e.g., services that use computing containers such as GitHub Actions).</span>
<span class="ansi-green-fg ansi-bold">    163</span>     <span style="font-style:italic;color:rgb(95,135,135)"># Please refer to the following PR for further details:</span>
<span class="ansi-green-fg ansi-bold">    164</span>     <span style="font-style:italic;color:rgb(95,135,135)"># https://github.com/optuna/optuna/pull/325.</span>
<span class="ansi-green-fg ansi-bold">    165</span>     <span style="font-weight:bold;color:rgb(0,135,0)">if</span> gc_after_trial:

File <span class="ansi-green-fg">~/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/optuna/study/_optimize.py:247</span>, in <span class="ansi-cyan-fg">_run_trial</span><span class="ansi-blue-fg">(study, func, catch)</span>
<span class="ansi-green-fg ansi-bold">    240</span>         <span style="font-weight:bold;color:rgb(0,135,0)">assert</span> <span style="font-weight:bold;color:rgb(0,135,0)">False</span>, <span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">Should not reach.</span><span style="color:rgb(175,0,0)">"</span>
<span class="ansi-green-fg ansi-bold">    242</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> (
<span class="ansi-green-fg ansi-bold">    243</span>     frozen_trial<span style="color:rgb(98,98,98)">.</span>state <span style="color:rgb(98,98,98)">==</span> TrialState<span style="color:rgb(98,98,98)">.</span>FAIL
<span class="ansi-green-fg ansi-bold">    244</span>     <span style="font-weight:bold;color:rgb(175,0,255)">and</span> func_err <span style="font-weight:bold;color:rgb(175,0,255)">is</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="font-weight:bold;color:rgb(0,135,0)">None</span>
<span class="ansi-green-fg ansi-bold">    245</span>     <span style="font-weight:bold;color:rgb(175,0,255)">and</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> <span style="color:rgb(0,135,0)">isinstance</span>(func_err, catch)
<span class="ansi-green-fg ansi-bold">    246</span> ):
<span class="ansi-green-fg">--&gt; 247</span>     <span style="font-weight:bold;color:rgb(0,135,0)">raise</span> func_err
<span class="ansi-green-fg ansi-bold">    248</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> frozen_trial

File <span class="ansi-green-fg">~/mambaforge/envs/zetteldev-diffcurv/lib/python3.11/site-packages/optuna/study/_optimize.py:196</span>, in <span class="ansi-cyan-fg">_run_trial</span><span class="ansi-blue-fg">(study, func, catch)</span>
<span class="ansi-green-fg ansi-bold">    194</span> <span style="font-weight:bold;color:rgb(0,135,0)">with</span> get_heartbeat_thread(trial<span style="color:rgb(98,98,98)">.</span>_trial_id, study<span style="color:rgb(98,98,98)">.</span>_storage):
<span class="ansi-green-fg ansi-bold">    195</span>     <span style="font-weight:bold;color:rgb(0,135,0)">try</span>:
<span class="ansi-green-fg">--&gt; 196</span>         value_or_values <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">func</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">trial</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    197</span>     <span style="font-weight:bold;color:rgb(0,135,0)">except</span> exceptions<span style="color:rgb(98,98,98)">.</span>TrialPruned <span style="font-weight:bold;color:rgb(0,135,0)">as</span> e:
<span class="ansi-green-fg ansi-bold">    198</span>         <span style="font-style:italic;color:rgb(95,135,135)"># TODO(mamu): Handle multi-objective cases.</span>
<span class="ansi-green-fg ansi-bold">    199</span>         state <span style="color:rgb(98,98,98)">=</span> TrialState<span style="color:rgb(98,98,98)">.</span>PRUNED

Cell <span class="ansi-green-fg">In[19], line 61</span>, in <span class="ansi-cyan-fg">objective</span><span class="ansi-blue-fg">(trial)</span>
<span class="ansi-green-fg ansi-bold">     59</span> <span style="color:rgb(0,135,0)">print</span>(<span style="color:rgb(175,0,0)">"</span><span style="color:rgb(175,0,0)">index is </span><span style="color:rgb(175,0,0)">"</span>, SS1<span style="color:rgb(98,98,98)">.</span>idx)
<span class="ansi-green-fg ansi-bold">     60</span> <span style="font-weight:bold;color:rgb(0,135,0)">for</span> X <span style="font-weight:bold;color:rgb(175,0,255)">in</span> tqdm(SS1):
<span class="ansi-green-fg">---&gt; 61</span>     kernel, ns <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">tune_curvature_agnostic_kernel</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">size_of_first_scale</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">tolerance</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">params</span><span class="ansi-yellow-bg">[</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">tolerance</span><span style="color:rgb(175,0,0)" class="ansi-yellow-bg">'</span><span class="ansi-yellow-bg">]</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">max_iterations</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">100</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">     62</span>     DC <span style="color:rgb(98,98,98)">=</span> DiffusionCurvature2(
<span class="ansi-green-fg ansi-bold">     63</span>         graph_former <span style="color:rgb(98,98,98)">=</span> kernel
<span class="ansi-green-fg ansi-bold">     64</span>     )
<span class="ansi-green-fg ansi-bold">     65</span>     ks <span style="color:rgb(98,98,98)">=</span> DC<span style="color:rgb(98,98,98)">.</span>fit(X, dim <span style="color:rgb(98,98,98)">=</span> X<span style="color:rgb(98,98,98)">.</span>shape[<span style="color:rgb(98,98,98)">1</span>] <span style="color:rgb(98,98,98)">-</span> <span style="color:rgb(98,98,98)">1</span>, idx <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">0</span>, ts <span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(0,135,0)">list</span>(<span style="color:rgb(0,135,0)">range</span>(<span style="color:rgb(98,98,98)">1</span>,params[<span style="color:rgb(175,0,0)">'</span><span style="color:rgb(175,0,0)">max_t</span><span style="color:rgb(175,0,0)">'</span>])))

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:240</span>, in <span class="ansi-cyan-fg">tune_curvature_agnostic_kernel</span><span class="ansi-blue-fg">(X, num_in_first_scale, tolerance, eps, max_iterations, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    238</span> total_runs <span style="color:rgb(98,98,98)">+</span><span style="color:rgb(98,98,98)">=</span> <span style="color:rgb(98,98,98)">1</span>
<span class="ansi-green-fg ansi-bold">    239</span> ns <span style="color:rgb(98,98,98)">=</span> (lower_bound <span style="color:rgb(98,98,98)">+</span> upper_bound) <span style="color:rgb(98,98,98)">/</span> <span style="color:rgb(98,98,98)">2</span>
<span class="ansi-green-fg">--&gt; 240</span> num, kernel <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">try_kernel_with_neighbor_scale</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">ns</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span style="color:rgb(98,98,98)" class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    241</span> num <span style="color:rgb(98,98,98)">=</span> num<span style="color:rgb(98,98,98)">.</span>item()
<span class="ansi-green-fg ansi-bold">    243</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> num <span style="color:rgb(98,98,98)">&gt;</span> num_in_first_scale:

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:226</span>, in <span class="ansi-cyan-fg">tune_curvature_agnostic_kernel.&lt;locals&gt;.try_kernel_with_neighbor_scale</span><span class="ansi-blue-fg">(X, ns, **kwargs)</span>
<span class="ansi-green-fg ansi-bold">    224</span> <span style="font-weight:bold;color:rgb(0,135,0)">def</span> <span style="color:rgb(0,0,255)">try_kernel_with_neighbor_scale</span>(X, ns, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs):
<span class="ansi-green-fg ansi-bold">    225</span>         kernel <span style="color:rgb(98,98,98)">=</span> partial(get_curvature_agnostic_graph, neighbor_scale <span style="color:rgb(98,98,98)">=</span> ns, <span style="color:rgb(98,98,98)">*</span><span style="color:rgb(98,98,98)">*</span>kwargs)
<span class="ansi-green-fg">--&gt; 226</span>         G <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">kernel</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">X</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    227</span>         P <span style="color:rgb(98,98,98)">=</span> diffusion_matrix_from_graph(G)
<span class="ansi-green-fg ansi-bold">    228</span>         num <span style="color:rgb(98,98,98)">=</span> num_in_first_scale_of_diffusion(P, eps)

File <span class="ansi-green-fg">~/Pumberton/Workshop/21-SUMRY-Curvature/diffusion-curvature/diffusion_curvature/kernels.py:114</span>, in <span class="ansi-cyan-fg">get_curvature_agnostic_graph</span><span class="ansi-blue-fg">(X, neighbor_scale, k, alpha, self_loops, simple_graph)</span>
<span class="ansi-green-fg ansi-bold">    112</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> <span style="font-weight:bold;color:rgb(175,0,255)">not</span> self_loops: np<span style="color:rgb(98,98,98)">.</span>fill_diagonal(W, <span style="color:rgb(98,98,98)">0</span>)
<span class="ansi-green-fg ansi-bold">    113</span> <span style="font-weight:bold;color:rgb(0,135,0)">if</span> simple_graph:
<span class="ansi-green-fg">--&gt; 114</span>     G <span style="color:rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">SimpleGraph</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">W</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg ansi-bold">    115</span> <span style="font-weight:bold;color:rgb(0,135,0)">else</span>:
<span class="ansi-green-fg ansi-bold">    116</span>     <span style="font-weight:bold;color:rgb(0,135,0)">with</span> warnings<span style="color:rgb(98,98,98)">.</span>catch_warnings():

File <span class="ansi-green-fg">&lt;string&gt;:2</span>, in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, W)</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>
</div></div>
<p>::: {#cell-17 .cell 0=‘e’ 1=‘x’ 2=‘p’ 3=‘o’ 4=‘r’ 5=‘t’}</p>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="at">@call_parse</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    search_parameters <span class="op">=</span> <span class="va">False</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>):</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> search_parameters:</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        optimize_parameters()</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        run_sadspheres()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>:::</p>
<div class="cell-container"><div class="cell-decorator"><pre>In [9]:</pre></div><div id="cell-18" class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>nbdev_export</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div>
</section>
     </main>
<!-- /main column -->  <script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>  </div> <!-- /content -->  <script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","selector":".lightbox","openEffect":"zoom","loop":false,"descPosition":"bottom"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script> 
  
</body></html>