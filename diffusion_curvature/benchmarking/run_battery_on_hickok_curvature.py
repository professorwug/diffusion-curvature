# AUTOGENERATED! DO NOT EDIT! File to edit: ../../nbs/4b-hickock-curvature-of-battery.ipynb.

# %% auto 0
__all__ = ['battery_file', 'rmax', 'name_of_run', 'curvature_fn', 'main']

# %% ../../nbs/4b-hickock-curvature-of-battery.ipynb 1
# parameters for run
battery_file = "/home/piriac/data/diffusion_curvature/Curvature_Colosseum_dikey.h5"
# tiny_battery_file = "/home/piriac/data/diffusion_curvature/Curvature_Colosseum_LowD_HighSampled.h5" # for test runs
rmax = 6.26
name_of_run = f"core_rmax-{rmax}"
print(name_of_run)

# %% ../../nbs/4b-hickock-curvature-of-battery.ipynb 2
from .hickok import scalar_curvature_est 
def curvature_fn(X, dim, rmax = rmax):
    SC = scalar_curvature_est(
        n = dim, #manifold dim
        X = X, #data
        verbose=False,
    )
    ks_est = SC.estimate(rmax=rmax, indices=[0])
    return ks_est[0]

# %% ../../nbs/4b-hickock-curvature-of-battery.ipynb 3
import tqdm
from .curvature_colosseum import compute_curvature_on_battery
from fastcore.all import *
import deepdish

@call_parse
def main():
    # load curvature battery
    CC = deepdish.io.load(battery_file)

    saved_calcs = f"/home/piriac/data/diffusion_curvature/computed_hickok_curvatures_{name_of_run}.h5"
    if os.path.exists(saved_calcs):
        print(f"Loading saved calculations from {saved_calcs}")
        computed_curvatures = deepdish.io.load(saved_calcs)
    else:
        computed_curvatures = compute_curvature_on_battery(curvature_fn, CC)
        deepdish.io.save(f"/home/piriac/data/diffusion_curvature/computed_hickok_curvatures_core_{name_of_run}.h5", computed_curvatures)
    return computed_curvatures
