<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Curvature computations on any graphtools graph">

<title>diffusion_curvature - Implementation (PyGSP + JAX)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="diffusion_curvature - Implementation (PyGSP + JAX)">
<meta property="og:description" content="">
<meta property="og:image" content="https://professorwug.github.io/diffusion_curvature/library/Core_files/figure-html/cell-18-output-2.png">
<meta property="og:site-name" content="diffusion_curvature">
<meta property="og:image:height" content="423">
<meta property="og:image:width" content="565">
<meta name="twitter:title" content="diffusion_curvature - Implementation (PyGSP + JAX)">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="https://professorwug.github.io/diffusion_curvature/library/Core_files/figure-html/cell-18-output-2.png">
<meta name="twitter:image-height" content="423">
<meta name="twitter:image-width" content="565">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">diffusion_curvature</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/professorwug/diffusion_curvature" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../library/Comparison Space Construction.html">library</a></li><li class="breadcrumb-item"><a href="../library/Core.html">Implementation (PyGSP + JAX)</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">documentation</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../documentation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diffusion Curvature</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">experiments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3a Visual Battery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3a A Visual Battery of Benchmarks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3a1 DC of Battery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3a1 Computing the diffusion curvature of the battery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3a1a DC of LowD High Sample Battery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3a1a Computing the diffusion curvature of the battery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3a2 Hickok Curvature of Battery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3a2 Hickok Curvature of Battery.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3b Hickok Comparison.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3b Hickok Comparison.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3c Sampling Experiments.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3c Sampling Experiments on Diffusion Curvature</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3d Detecting Negative Curvature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3d Detecting Negative Curvature</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3d1 Effects of Graph Construction on Negative Curvature Detection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3d1 Effects of Graph Construction on Negative Curvature</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3e Curvature with (Neural) Flattening.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3e Curvature Via (Neural) Flattening</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3e1 Flattening with Diffusion Models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3e1 Flattening with Diffusion Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/3e2 Neural Flattening with Gromov Wasserstein.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3e2 Neural Flattening with Gromov Wasserstein</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/Curvature by Quadratic Fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Scalar Curvature by Volume Comparison</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/Diffusion Laziness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Measurements of Diffusion Laziness</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/Examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Examples</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/Explorations in Lazy-first diffusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Explorations in Lazy-first Diffusion Curvature</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experiments/Neumann Heat Kernel via Chebyshev Approximation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Analytic estimation of the heat kernel</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">library</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Comparison Space Construction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Comparison Space Construction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Construct Battery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">3a Construct Battery</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Core.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementation (PyGSP + JAX)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Curvature Enhanced Spectral Clustering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1d Curvature Clustering</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Datasets</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Diffusion Entropy for Optimal t.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diffusion Entropy for Optimal t.html</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Diffusion Laziness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diffusion Laziness Estimators</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Diffusion Ricci Curvature.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Diffusion Ricci Curvature</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Graph Creation Utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Heat Diffusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Heat Diffusion</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Kernels.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Kernels</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Manifold Distances.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manifold Distances</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Mean Flat Entropies.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">1c1 Mean Entropy of Uniform Flat Spaces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Random Surfaces.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Random Surfaces</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Utils</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/Volume Estimation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Volume Estimation with Heat Diffusion</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../library/continuous_normalizing_flows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapping the Data to a Flat Space with Continuous Normalizing Flows</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#graph-construction" id="toc-graph-construction" class="nav-link active" data-scroll-target="#graph-construction">Graph Construction</a></li>
  <li><a href="#the-diffusion-curvature-class" id="toc-the-diffusion-curvature-class" class="nav-link" data-scroll-target="#the-diffusion-curvature-class">The Diffusion Curvature Class</a>
  <ul>
  <li><a href="#fill_diagonal" id="toc-fill_diagonal" class="nav-link" data-scroll-target="#fill_diagonal">fill_diagonal</a></li>
  <li><a href="#diffusioncurvature" id="toc-diffusioncurvature" class="nav-link" data-scroll-target="#diffusioncurvature">DiffusionCurvature</a></li>
  <li><a href="#get_adaptive_graph" id="toc-get_adaptive_graph" class="nav-link" data-scroll-target="#get_adaptive_graph">get_adaptive_graph</a></li>
  <li><a href="#simplegraph" id="toc-simplegraph" class="nav-link" data-scroll-target="#simplegraph">SimpleGraph</a></li>
  <li><a href="#graphtools_graph_from_data" id="toc-graphtools_graph_from_data" class="nav-link" data-scroll-target="#graphtools_graph_from_data">graphtools_graph_from_data</a></li>
  </ul></li>
  <li><a href="#verification" id="toc-verification" class="nav-link" data-scroll-target="#verification">Verification</a>
  <ul>
  <li><a href="#with-approximated-heat-diffusion" id="toc-with-approximated-heat-diffusion" class="nav-link" data-scroll-target="#with-approximated-heat-diffusion">With Approximated Heat Diffusion</a></li>
  <li><a href="#on-the-plane" id="toc-on-the-plane" class="nav-link" data-scroll-target="#on-the-plane">On the Plane</a></li>
  <li><a href="#how-bout-a-donut" id="toc-how-bout-a-donut" class="nav-link" data-scroll-target="#how-bout-a-donut">How bout a donut?</a>
  <ul class="collapse">
  <li><a href="#with-fixed-flattening" id="toc-with-fixed-flattening" class="nav-link" data-scroll-target="#with-fixed-flattening">With Fixed Flattening</a></li>
  <li><a href="#with-grid" id="toc-with-grid" class="nav-link" data-scroll-target="#with-grid">With Grid</a></li>
  <li><a href="#with-wasserstein" id="toc-with-wasserstein" class="nav-link" data-scroll-target="#with-wasserstein">With Wasserstein</a></li>
  <li><a href="#with-laziness" id="toc-with-laziness" class="nav-link" data-scroll-target="#with-laziness">With Laziness</a></li>
  <li><a href="#with-vne-t-selection" id="toc-with-vne-t-selection" class="nav-link" data-scroll-target="#with-vne-t-selection">With VNE t selection</a></li>
  <li><a href="#with-neural-flattening" id="toc-with-neural-flattening" class="nav-link" data-scroll-target="#with-neural-flattening">With Neural Flattening</a></li>
  <li><a href="#with-mean-flattening" id="toc-with-mean-flattening" class="nav-link" data-scroll-target="#with-mean-flattening">With Mean Flattening</a></li>
  </ul></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/professorwug/diffusion_curvature/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Implementation (PyGSP + JAX)</h1>
</div>

<div>
  <div class="description">
    Curvature computations on any graphtools graph
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<p>This notebook implements diffusion curvature atop the popular PyGSP library. To compute the curvature of any PyGSP graph, simply instantiate a <code>DiffusionCurvature</code> object with your choice of parameters, and pass the graphtools graph through as input.</p>
<p>What follows is a literate implementation, showing the steps of the algorithm applied to our old friend, the torus.</p>
<p>The implementation of Diffusion Curvature involves several big pieces, each of which can be performed with different strategies:</p>
<ol type="1">
<li>Simulating heat diffusion on the manifold, either via powering the diffusion matrix, or by Chebyshev approximation of the heat equation using the graph laplacian.</li>
<li>Computing the “spreads” of diffusion. This can be done either via the entropy or the Wasserstein distance.</li>
<li>Constructing a comparison space of approximately the same sampling as the input graph.</li>
<li>(Experimental) Verification that the above is working by differentiating the spreads of diffusion over time.</li>
</ol>
<p>We implement everything generically in JAX (a high performance numpy replacement, which can compile to the GPU), treating each of the above as modules that can be parametrically tuned. Functional programming is our game: each function takes a graph object as input and returns an updated graph object with the required quantities computed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.datasets <span class="im">import</span> torus</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our sample dataset for testing the rest of the notebook</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>X_torus, ks_torus <span class="op">=</span> torus(<span class="dv">5000</span>,use_guide_points<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="graph-construction" class="level1">
<h1>Graph Construction</h1>
<p>Our ‘Graphs’ notebook has code to create PyGSP graphs from pointcloud data, in several varieties. We also provide heuristics to sanity check the graphs, as well as choose the optimal parameters. TODO: MAKE THESE HEURISTICS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> diffusion_curvature.graphs <span class="im">import</span> get_alpha_decay_graph, get_knn_graph, get_scanpy_graph</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>G_torus <span class="op">=</span> get_alpha_decay_graph(X_torus,knn<span class="op">=</span><span class="dv">15</span>,decay<span class="op">=</span><span class="dv">20</span>,anisotropy<span class="op">=</span><span class="fl">1.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-diffusion-curvature-class" class="level1">
<h1>The Diffusion Curvature Class</h1>
<hr>
<section id="fill_diagonal" class="level3">
<h3 class="anchored" data-anchor-id="fill_diagonal">fill_diagonal</h3>
<blockquote class="blockquote">
<pre><code> fill_diagonal (a, val)</code></pre>
</blockquote>
<hr>
</section>
<section id="diffusioncurvature" class="level3">
<h3 class="anchored" data-anchor-id="diffusioncurvature">DiffusionCurvature</h3>
<blockquote class="blockquote">
<pre><code> DiffusionCurvature
                     (diffusion_type:Literal['diffusionmatrix','heatkernel
                     ']='diffusion matrix', laziness_method:Literal['Wasse
                     rstein','Entropic','Laziness']='Entropic', flattening
                     _method:Literal['Neural','Fixed','MeanFixed']='Fixed'
                     , comparison_method:Literal['Ollivier','Subtraction']
                     ='Subtraction', graph_former=&lt;function
                     get_adaptive_graph&gt;, dimest=None,
                     points_per_cluster=None,
                     comparison_space_size_factor=1, use_grid=False,
                     max_flattening_epochs=50, aperture=20, smoothing=1, c
                     omparison_space_file='../data/entropies_averaged.h5',
                     verbose=False)</code></pre>
</blockquote>
<p>Initialize self. See help(type(self)) for accurate signature.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 25%">
<col style="width: 34%">
<col style="width: 34%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th><strong>Type</strong></th>
<th><strong>Default</strong></th>
<th><strong>Details</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>diffusion_type</td>
<td>Literal</td>
<td>diffusion matrix</td>
<td>Either [‘diffusion matrix’,‘heat kernel’]</td>
</tr>
<tr class="even">
<td>laziness_method</td>
<td>Literal</td>
<td>Entropic</td>
<td>Either [‘Wasserstein’,‘Entropic’, ‘Laziness’]</td>
</tr>
<tr class="odd">
<td>flattening_method</td>
<td>Literal</td>
<td>Fixed</td>
<td>Either [‘Neural’, ‘Fixed’, ‘Mean Fixed’]</td>
</tr>
<tr class="even">
<td>comparison_method</td>
<td>Literal</td>
<td>Subtraction</td>
<td>Either [‘Ollivier’, ‘Subtraction’]</td>
</tr>
<tr class="odd">
<td>graph_former</td>
<td>function</td>
<td>get_adaptive_graph</td>
<td></td>
</tr>
<tr class="even">
<td>dimest</td>
<td>NoneType</td>
<td>None</td>
<td>Dimension estimator to use. If none, defaults to kNN.</td>
</tr>
<tr class="odd">
<td>points_per_cluster</td>
<td>NoneType</td>
<td>None</td>
<td>Number of points to use in each cluster when constructing comparison spaces. Each comparison space takes about 20sec to construct, and has different sampling and dimension. If 1, constructs a different comparison space for each point; if None, constructs just one comparison space.</td>
</tr>
<tr class="even">
<td>comparison_space_size_factor</td>
<td>int</td>
<td>1</td>
<td>Number of points in comparison space is the number of points in the original space divided by this factor.</td>
</tr>
<tr class="odd">
<td>use_grid</td>
<td>bool</td>
<td>False</td>
<td>If True, uses a grid of points as the comparison space. If False, uses a random sample of points.</td>
</tr>
<tr class="even">
<td>max_flattening_epochs</td>
<td>int</td>
<td>50</td>
<td></td>
</tr>
<tr class="odd">
<td>aperture</td>
<td>int</td>
<td>20</td>
<td>if using Laziness flattening, this controls the size of neighborhood over which the return probability is averaged.</td>
</tr>
<tr class="even">
<td>smoothing</td>
<td>int</td>
<td>1</td>
<td></td>
</tr>
<tr class="odd">
<td>comparison_space_file</td>
<td>str</td>
<td>../data/entropies_averaged.h5</td>
<td></td>
</tr>
<tr class="even">
<td>verbose</td>
<td>bool</td>
<td>False</td>
<td></td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="get_adaptive_graph" class="level3">
<h3 class="anchored" data-anchor-id="get_adaptive_graph">get_adaptive_graph</h3>
<blockquote class="blockquote">
<pre><code> get_adaptive_graph (X, k=10, alpha=0)</code></pre>
</blockquote>
<hr>
</section>
<section id="simplegraph" class="level3">
<h3 class="anchored" data-anchor-id="simplegraph">SimpleGraph</h3>
<blockquote class="blockquote">
<pre><code> SimpleGraph (W:numpy.ndarray)</code></pre>
</blockquote>
<hr>
</section>
<section id="graphtools_graph_from_data" class="level3">
<h3 class="anchored" data-anchor-id="graphtools_graph_from_data">graphtools_graph_from_data</h3>
<blockquote class="blockquote">
<pre><code> graphtools_graph_from_data (X)</code></pre>
</blockquote>
</section>
</section>
<section id="verification" class="level1">
<h1>Verification</h1>
<section id="with-approximated-heat-diffusion" class="level3">
<h3 class="anchored" data-anchor-id="with-approximated-heat-diffusion">With Approximated Heat Diffusion</h3>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>X_torus,ks <span class="op">=</span> torus(<span class="dv">1000</span>,use_guide_points<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>G_torus <span class="op">=</span> get_adaptive_graph(X_torus)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2024-01-04 08:58:24,896:[WARNING](pygsp.graphs.graph.check_weights): The main diagonal of the weight matrix is not 0!</code></pre>
</div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>G_torus.W.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>(1000, 1000)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    diffusion_type <span class="op">=</span> <span class="st">"heat kernel"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    use_grid<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="59">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>Rn <span class="op">=</span> np.random.rand(<span class="dv">400</span>,<span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>Grn <span class="op">=</span> DC.graph_former(Rn)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2024-01-04 08:59:12,340:[WARNING](pygsp.graphs.graph.check_weights): The main diagonal of the weight matrix is not 0!</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>Grn.W.shape</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>(400, 400)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="va">None</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>2024-01-04 08:59:31,999:[WARNING](pygsp.graphs.graph.check_weights): The main diagonal of the weight matrix is not 0!
IOPub data rate exceeded.
The Jupyter server will temporarily stop sending output
to the client in order to avoid crashing it.
To change this limit, set the config variable
`--ServerApp.iopub_data_rate_limit`.

Current values:
ServerApp.iopub_data_rate_limit=1000000.0 (bytes/sec)
ServerApp.rate_limit_window=3.0 (secs)
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>(1000,)</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: axis -1 is out of bounds for array of dimension 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: x and y must be the same size</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Core_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>X_sphere, ks_sphere <span class="op">=</span> sphere(<span class="dv">1000</span>,use_guide_points<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>G_sphere <span class="op">=</span> get_adaptive_graph(X_sphere)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    graph_former <span class="op">=</span> get_adaptive_graph,</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>sphere_entropy <span class="op">=</span> DC.unsigned_curvature(G_sphere, t<span class="op">=</span><span class="dv">25</span>)[<span class="dv">0</span>]</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Sphere entropies are "</span>, sphere_entropy)</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>DC.curvature(G_sphere,t<span class="op">=</span><span class="dv">25</span>,dim<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sphere entropies are  6.655565</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>Array([0.11335707, 0.06487274, 0.05884409, 0.05740404, 0.0642314 ,
       0.06366301, 0.05483818, 0.06147385, 0.08759928, 0.05728197,
       0.06411648, 0.08686781, 0.05503988, 0.09050846, 0.08116913,
       0.03181219, 0.12897491, 0.08714104, 0.06678724, 0.05969143,
       0.07953739, 0.07100677, 0.06172848, 0.08681393, 0.07116699,
       0.09487152, 0.08594608, 0.06987953, 0.08752728, 0.08381319,
       0.10403967, 0.09759521, 0.08669853, 0.07118797, 0.05764246,
       0.09759665, 0.10303497, 0.0868988 , 0.10510015, 0.06851149,
       0.09032917, 0.07850552, 0.04110861, 0.05405045, 0.05058098,
       0.06604719, 0.10579872, 0.0817647 , 0.07427454, 0.06593466,
       0.08328724, 0.07362413, 0.09141922, 0.10187674, 0.05985785,
       0.09553814, 0.06983089, 0.04920149, 0.07766151, 0.09164715,
       0.07969284, 0.04097891, 0.0702467 , 0.06564188, 0.08948517,
       0.0845356 , 0.09049368, 0.10028028, 0.0979805 , 0.0927496 ,
       0.08528709, 0.08123779, 0.08337545, 0.06309032, 0.08763933,
       0.09051132, 0.05973339, 0.09566021, 0.06791067, 0.06535816,
       0.06742287, 0.05220127, 0.08181667, 0.07960033, 0.08837652,
       0.03656912, 0.09111023, 0.10952806, 0.05620575, 0.09327269,
       0.12839031, 0.13030815, 0.09196281, 0.07912397, 0.06233597,
       0.07339478, 0.11855936, 0.07903099, 0.09766197, 0.05419445,
       0.08125305, 0.06524277, 0.05321598, 0.08076906, 0.08762741,
       0.06943989, 0.13047361, 0.04755688, 0.08558178, 0.07583284,
       0.07408619, 0.07964134, 0.07853556, 0.08562994, 0.08383465,
       0.07005501, 0.08957243, 0.08760738, 0.10600567, 0.07975292,
       0.07248878, 0.08154964, 0.08699846, 0.11436415, 0.07627773,
       0.06837606, 0.07192278, 0.06020164, 0.10035324, 0.05051041,
       0.08448887, 0.11090851, 0.07821178, 0.09141922, 0.08282757,
       0.05962753, 0.08533669, 0.09196186, 0.06243706, 0.07434845,
       0.06517315, 0.12801504, 0.07238007, 0.08558321, 0.08384991,
       0.11973953, 0.05550003, 0.06878376, 0.07501745, 0.07222176,
       0.06437016, 0.07418203, 0.08648586, 0.07268524, 0.09285355,
       0.1021452 , 0.09206486, 0.05852842, 0.11701012, 0.09866571,
       0.06476784, 0.05934143, 0.06882191, 0.10729408, 0.08915997,
       0.07189846, 0.06034374, 0.08197355, 0.09082222, 0.07134485,
       0.09181786, 0.07562733, 0.08058929, 0.08986425, 0.10321665,
       0.08199501, 0.11547995, 0.08556461, 0.06375408, 0.09595585,
       0.07134056, 0.05936003, 0.10069847, 0.0920248 , 0.0682478 ,
       0.08965921, 0.10433626, 0.07322884, 0.09017277, 0.07954979,
       0.06465578, 0.08976555, 0.08947659, 0.10598612, 0.07743883,
       0.07683754, 0.06537199, 0.09267139, 0.09297276, 0.05983925,
       0.08270025, 0.08384848, 0.0358305 , 0.07146597, 0.05775452,
       0.06509686, 0.08713055, 0.11515236, 0.06367111, 0.05358601,
       0.07762241, 0.06050825, 0.1136961 , 0.06980181, 0.12893963,
       0.08900356, 0.06705284, 0.09195375, 0.09817123, 0.05263329,
       0.09058428, 0.06303692, 0.05026817, 0.08079863, 0.06897879,
       0.07525492, 0.08952808, 0.06900883, 0.0867424 , 0.08868504,
       0.10039949, 0.06827116, 0.05599594, 0.09328413, 0.06389952,
       0.09408426, 0.08490419, 0.0847168 , 0.10274601, 0.09403706,
       0.10481405, 0.07272911, 0.07094669, 0.07708597, 0.11218977,
       0.07840681, 0.12765694, 0.07936001, 0.06864929, 0.08695459,
       0.05975056, 0.12005091, 0.11665201, 0.08816004, 0.07531261,
       0.07729721, 0.11365318, 0.13855743, 0.07913589, 0.0781889 ,
       0.10389757, 0.12170601, 0.08514786, 0.075634  , 0.121315  ,
       0.06645107, 0.07601118, 0.060853  , 0.07239103, 0.08244514,
       0.10001373, 0.06660032, 0.06484604, 0.08138657, 0.09447384,
       0.06897068, 0.06223488, 0.09180164, 0.09990549, 0.06732178,
       0.09585047, 0.08702803, 0.06343746, 0.08570433, 0.09392262,
       0.10494709, 0.07350254, 0.05890846, 0.09878397, 0.07083607,
       0.07613325, 0.07218266, 0.08658457, 0.06997585, 0.09469509,
       0.06267452, 0.12497616, 0.08941078, 0.06324816, 0.0883131 ,
       0.10312557, 0.05045891, 0.05594158, 0.0553751 , 0.03766966,
       0.07313347, 0.07922935, 0.06505299, 0.06317997, 0.06878376,
       0.07766485, 0.09556961, 0.06594181, 0.07470226, 0.04703426,
       0.06539726, 0.06102371, 0.08212614, 0.064394  , 0.07518148,
       0.08916044, 0.07245684, 0.10277367, 0.06812429, 0.11281776,
       0.05020905, 0.12582445, 0.0698595 , 0.07491112, 0.11322117,
       0.08710861, 0.10459757, 0.07035112, 0.09850311, 0.08914948,
       0.05855513, 0.07848549, 0.07558823, 0.09352541, 0.09365845,
       0.10718155, 0.0929184 , 0.07888508, 0.05945444, 0.06639957,
       0.06795168, 0.07767439, 0.08326626, 0.06954002, 0.12832832,
       0.05132866, 0.05683613, 0.08876944, 0.08475208, 0.06815004,
       0.06830788, 0.06574154, 0.0684433 , 0.09315252, 0.06450844,
       0.08112144, 0.07032013, 0.07417583, 0.0657177 , 0.06024456,
       0.07568312, 0.06376934, 0.07691145, 0.09345627, 0.05396366,
       0.07360935, 0.06457043, 0.08803082, 0.12340546, 0.0430851 ,
       0.07584906, 0.0856905 , 0.0761919 , 0.0712986 , 0.05959988,
       0.09634113, 0.0748415 , 0.0676074 , 0.06634808, 0.10871696,
       0.08019495, 0.07570696, 0.10012627, 0.09920406, 0.10649729,
       0.06039715, 0.08942413, 0.06424427, 0.06639147, 0.0746727 ,
       0.09383821, 0.07926512, 0.0873909 , 0.08634281, 0.08192921,
       0.09456968, 0.11109734, 0.07531071, 0.04559326, 0.08145332,
       0.06811523, 0.09026051, 0.11224699, 0.06617832, 0.09417629,
       0.06792831, 0.08418083, 0.08686972, 0.12643385, 0.07878637,
       0.11114264, 0.04911709, 0.1169157 , 0.09134436, 0.08148003,
       0.09504318, 0.06370163, 0.08488941, 0.05987835, 0.13197803,
       0.05270767, 0.07995224, 0.10610676, 0.09008026, 0.06410074,
       0.06399536, 0.09253311, 0.08636713, 0.08924484, 0.12523079,
       0.06997776, 0.05615473, 0.07116127, 0.10870552, 0.07948971,
       0.08502913, 0.08753777, 0.10682964, 0.06801271, 0.08881092,
       0.0724144 , 0.07473373, 0.05977488, 0.0730381 , 0.08695221,
       0.08825588, 0.06974459, 0.0753336 , 0.09509182, 0.06197834,
       0.12962246, 0.11076736, 0.066998  , 0.08677197, 0.07073832,
       0.06846046, 0.05604649, 0.06168699, 0.09479332, 0.08106232,
       0.04374695, 0.0801959 , 0.050807  , 0.04700708, 0.09164667,
       0.10939503, 0.07735872, 0.02810955, 0.07032681, 0.07296419,
       0.07951736, 0.1094861 , 0.04912567, 0.05851364, 0.06599331,
       0.08242798, 0.07835865, 0.09446859, 0.06521273, 0.04284096,
       0.06164026, 0.05933475, 0.08355713, 0.10876608, 0.08352518,
       0.05979013, 0.09145069, 0.06964779, 0.06091166, 0.06638336,
       0.05623055, 0.0547452 , 0.06066704, 0.06565952, 0.08337498,
       0.08589268, 0.04935074, 0.05903912, 0.09692955, 0.11697578,
       0.07919025, 0.05324936, 0.07700825, 0.08991051, 0.05273294,
       0.06016684, 0.10387182, 0.06958485, 0.07950401, 0.06951571,
       0.10289955, 0.12402725, 0.09953022, 0.09806585, 0.1200881 ,
       0.06803513, 0.08253002, 0.08372974, 0.09606314, 0.1183157 ,
       0.08200359, 0.09499502, 0.12273884, 0.07668495, 0.08426666,
       0.07928753, 0.12814236, 0.09317827, 0.09383011, 0.08512974,
       0.06221008, 0.07291174, 0.06158972, 0.05036497, 0.08027458,
       0.10799599, 0.06039429, 0.0906496 , 0.12017775, 0.06580544,
       0.08006144, 0.08427143, 0.0949769 , 0.08249712, 0.06364822,
       0.07249451, 0.09234619, 0.07545185, 0.06292343, 0.09534073,
       0.0941124 , 0.06604958, 0.08753014, 0.08483124, 0.03575754,
       0.09688711, 0.08427143, 0.0531044 , 0.07679749, 0.10072041,
       0.09100342, 0.07741117, 0.11707878, 0.07924509, 0.06065083,
       0.06410646, 0.09311676, 0.08045197, 0.09255266, 0.07558632,
       0.07061768, 0.09624672, 0.06072521, 0.04834604, 0.09179211,
       0.08602047, 0.06194878, 0.1180191 , 0.08250809, 0.11218929,
       0.06011295, 0.06771755, 0.08819771, 0.08334637, 0.13812065,
       0.06575394, 0.08996582, 0.07463837, 0.13619947, 0.09487867,
       0.07237339, 0.08357668, 0.05293703, 0.1101675 , 0.09483624,
       0.06139851, 0.08657265, 0.06527901, 0.07776165, 0.08658028,
       0.06300592, 0.12784863, 0.07217884, 0.08898067, 0.05928946,
       0.07586384, 0.10997868, 0.07899761, 0.06864738, 0.07841492,
       0.09145689, 0.08152771, 0.06027985, 0.05680513, 0.10590649,
       0.05463219, 0.10816479, 0.0886116 , 0.08026123, 0.11724281,
       0.09658051, 0.09207439, 0.08112001, 0.08570385, 0.11746883,
       0.0910573 , 0.07527733, 0.07693291, 0.06337786, 0.0533123 ,
       0.09091806, 0.12636948, 0.05478144, 0.06138515, 0.04859352,
       0.06402016, 0.09357166, 0.0969696 , 0.10683918, 0.06055164,
       0.07052898, 0.09449577, 0.09978724, 0.07355452, 0.05896282,
       0.08079243, 0.07213211, 0.07021332, 0.08699036, 0.07072878,
       0.11976337, 0.09253693, 0.06851482, 0.05401516, 0.06438017,
       0.08043289, 0.07372904, 0.07995892, 0.08799839, 0.05041265,
       0.044137  , 0.09023476, 0.07026005, 0.07932806, 0.05887413,
       0.06160069, 0.1092639 , 0.06742859, 0.08018112, 0.07509518,
       0.08341551, 0.11725616, 0.06489086, 0.07964468, 0.0903883 ,
       0.13405895, 0.09177256, 0.07189655, 0.09475994, 0.06470966,
       0.07616138, 0.07341385, 0.08142757, 0.05130863, 0.1085434 ,
       0.09552002, 0.08458424, 0.06920767, 0.09314871, 0.07234097,
       0.09067297, 0.06603003, 0.06534672, 0.09344578, 0.09195995,
       0.06970596, 0.09057093, 0.0634346 , 0.07300091, 0.0798645 ,
       0.05143881, 0.07696915, 0.09007931, 0.08588409, 0.08695078,
       0.072824  , 0.08639145, 0.09895086, 0.07088995, 0.06571484,
       0.12388325, 0.08738899, 0.09012747, 0.07936764, 0.08060551,
       0.07700014, 0.09607792, 0.06435394, 0.07954502, 0.0631609 ,
       0.08287907, 0.1208849 , 0.06450367, 0.10001469, 0.12327623,
       0.05649948, 0.06689167, 0.09239864, 0.05399513, 0.07621002,
       0.08848524, 0.07452536, 0.0740881 , 0.05610752, 0.05921936,
       0.06929207, 0.09212494, 0.05885172, 0.08980083, 0.08908844,
       0.06027317, 0.09336185, 0.07325745, 0.04906607, 0.07571459,
       0.05941582, 0.06444168, 0.05993938, 0.07133055, 0.07237768,
       0.08626509, 0.09695721, 0.08766174, 0.07289362, 0.05293512,
       0.04969406, 0.05608368, 0.09086418, 0.10088253, 0.0633564 ,
       0.09067631, 0.08647251, 0.08081388, 0.05587864, 0.08291006,
       0.08054352, 0.11178827, 0.10813284, 0.07212782, 0.10191488,
       0.07481098, 0.08961678, 0.07601929, 0.07112312, 0.0625639 ,
       0.09436321, 0.05116749, 0.09538364, 0.09458685, 0.08861494,
       0.07372522, 0.06473398, 0.10284948, 0.07118034, 0.05463266,
       0.05225754, 0.05532551, 0.06560755, 0.05490637, 0.12158346,
       0.09354687, 0.0847435 , 0.130579  , 0.07846737, 0.06517935,
       0.08480835, 0.06446791, 0.08926773, 0.07934189, 0.07303619,
       0.0624814 , 0.07749367, 0.08417702, 0.08885288, 0.06671333,
       0.0852232 , 0.05438328, 0.06187677, 0.09126759, 0.06946278,
       0.03325844, 0.07932758, 0.08590794, 0.06253338, 0.0816927 ,
       0.09391689, 0.1122179 , 0.08875847, 0.07191372, 0.09672832,
       0.0823431 , 0.05952024, 0.051054  , 0.10187626, 0.06600952,
       0.08030128, 0.13138914, 0.09526825, 0.06717682, 0.04946089,
       0.08749104, 0.13514328, 0.06309128, 0.05427265, 0.08188057,
       0.10002708, 0.09151554, 0.08147621, 0.09595966, 0.0814786 ,
       0.08463001, 0.09094143, 0.076087  , 0.06060266, 0.08299351,
       0.09974241, 0.08121109, 0.07871056, 0.03160238, 0.04907417,
       0.08376646, 0.06574059, 0.09810638, 0.06866074, 0.0599823 ,
       0.0912447 , 0.07961941, 0.0949831 , 0.08458138, 0.110888  ,
       0.0887146 , 0.05327415, 0.08838749, 0.06019258, 0.06787682,
       0.07150173, 0.06150913, 0.08768463, 0.09446049, 0.07628107,
       0.0777607 , 0.09572411, 0.11461926, 0.06961966, 0.04371357,
       0.10290718, 0.07389641, 0.11757326, 0.08449745, 0.09725189,
       0.06266117, 0.09806252, 0.0629673 , 0.10153055, 0.08573723,
       0.07448578, 0.0763731 , 0.07483196, 0.07042503, 0.08677483,
       0.08396435, 0.11277103, 0.09647322, 0.06644011, 0.12908268,
       0.06702042, 0.09411621, 0.06900978, 0.08332348, 0.07097864,
       0.10585499, 0.05586147, 0.07631302, 0.05942869, 0.06037331,
       0.0894084 , 0.08821344, 0.11110973, 0.04807377, 0.08792496,
       0.0760746 , 0.06967068, 0.08922672, 0.028965  , 0.08651161,
       0.08542585, 0.09427595, 0.08531189, 0.10176229, 0.09003162,
       0.12104511, 0.07161331, 0.07312965, 0.10148144, 0.08242655,
       0.0694809 , 0.06045151, 0.06627083, 0.09000969, 0.09677505,
       0.08189869, 0.1018281 , 0.06925154, 0.09970713, 0.11207676,
       0.06885433, 0.05326128, 0.06263638, 0.07164431, 0.07298803,
       0.07818079, 0.11038685, 0.08878708, 0.07209206, 0.06343794,
       0.10221481, 0.06774139, 0.08673811, 0.03009081, 0.05997753,
       0.06807661, 0.08285809, 0.03423882, 0.08674049, 0.09929848,
       0.04765987, 0.07797718, 0.06278992, 0.11527443, 0.08953571,
       0.09015942, 0.08607244, 0.08385897, 0.07640123, 0.06941175,
       0.0920949 , 0.0824852 , 0.08013582, 0.10355186, 0.08541107,
       0.10334301, 0.06365776, 0.07396507, 0.08944321, 0.06364107,
       0.06188726, 0.05822945, 0.09568787, 0.13042402, 0.07145357,
       0.08201027, 0.10353804, 0.09361458, 0.08052015, 0.09439564,
       0.07261038, 0.08382034, 0.08790207, 0.05024719, 0.06147575,
       0.11889267, 0.08236313, 0.0749197 , 0.07372189, 0.09831762],      dtype=float32)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>X_plane <span class="op">=</span> plane(<span class="bu">len</span>(X_sphere))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>G_plane <span class="op">=</span> get_adaptive_graph(X_plane)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>plane_entropy <span class="op">=</span> DC.unsigned_curvature(G_plane, t<span class="op">=</span><span class="dv">25</span>)[<span class="dv">0</span>]</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Plane entropy is "</span>, plane_entropy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Plane entropy is  6.802491</code></pre>
</div>
</div>
</section>
<section id="on-the-plane" class="level2">
<h2 class="anchored" data-anchor-id="on-the-plane">On the Plane</h2>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>X_plane <span class="op">=</span> plane(<span class="dv">1000</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>G_plane <span class="op">=</span> get_adaptive_graph(X_plane) <span class="co">#get_alpha_decay_graph(X_plane, decay=None, knn=15, anisotropy=1, )</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> diffusion_matrix_from_affinities(G_plane.W) <span class="co">#diff_op(G_plane).todense() # is sparse, by default</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> jnp.array(P)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>Pt <span class="op">=</span> jax_power_matrix(P,<span class="dv">8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the first scatter plot</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].scatter(X_plane[:,<span class="dv">0</span>],X_plane[:,<span class="dv">1</span>],c<span class="op">=</span>P[<span class="dv">0</span>].tolist(), cmap<span class="op">=</span><span class="st">'jet'</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">'Diffusion P'</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the second scatter plot</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].scatter(X_plane[:,<span class="dv">0</span>],X_plane[:,<span class="dv">1</span>],c<span class="op">=</span>Pt[<span class="dv">0</span>].tolist(), cmap<span class="op">=</span><span class="st">'jet'</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">'Diffusion Pt'</span>)</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Core_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,points_per_cluster<span class="op">=</span><span class="va">None</span>,comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>, flattening_method<span class="op">=</span><span class="st">"Fixed"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>ks_plane<span class="op">=</span> DC.curvature(G_plane, t<span class="op">=</span><span class="dv">8</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check that higher dimensional planes are also given flat curvature</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>planes <span class="op">=</span> [plane(<span class="dv">1000</span><span class="op">*</span><span class="dv">2</span><span class="op">**</span>(d<span class="op">-</span><span class="dv">2</span>), d) <span class="cf">for</span> d <span class="kw">in</span> ds]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, d <span class="kw">in</span> <span class="bu">enumerate</span>(ds):</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> get_adaptive_graph(planes[i]) <span class="co">#get_alpha_decay_graph(planes[i], decay=None, knn=15, anisotropy=1, )</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    DC <span class="op">=</span> DiffusionCurvature(laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,points_per_cluster<span class="op">=</span><span class="dv">500</span>,comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>, flattening_method<span class="op">=</span><span class="st">"Fixed"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    ks <span class="op">=</span> DC.curvature(G, t<span class="op">=</span><span class="dv">8</span>, dim<span class="op">=</span>d, knn<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"dimension"</span>,d,<span class="st">": Curvature of Plane is "</span>,ks[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>dimension 3 : Curvature of Plane is  0.0050811768
dimension 4 : Curvature of Plane is  -0.0046873093
dimension 5 : Curvature of Plane is  -0.000705719</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2024-01-03 19:46:52.845911: W external/tsl/tsl/framework/bfc_allocator.cc:485] Allocator (GPU_0_bfc) ran out of memory trying to allocate 976.68MiB (rounded to 1024128256)requested by op 
2024-01-03 19:46:52.846067: W external/tsl/tsl/framework/bfc_allocator.cc:497] ************************************************xx_____*************______________________________**
2024-01-03 19:46:52.846137: E external/xla/xla/pjrt/pjrt_stream_executor_client.cc:2716] Execution of replica 0 failed: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 1024128004 bytes.
BufferAssignment OOM Debugging.
BufferAssignment stats:
             parameter allocation:    1.91GiB
              constant allocation:         0B
        maybe_live_out allocation:  976.68MiB
     preallocated temp allocation:         0B
                 total allocation:    2.86GiB
              total fragmentation:         0B (0.00%)
Peak buffers:
    Buffer 1:
        Size: 976.68MiB
        Entry Parameter Subshape: f32[16001,16001]
        ==========================

    Buffer 2:
        Size: 976.68MiB
        Entry Parameter Subshape: f32[16001,16001]
        ==========================

    Buffer 3:
        Size: 976.68MiB
        Operator: op_name="jit(fn)/jit(main)/add" source_file="/home/piriac/Pumberton/Workshop/21-SUMRY-Curvature/diffusion_curvature/diffusion_curvature/graphs.py" source_line=131
        XLA Label: fusion
        Shape: f32[16001,16001]
        ==========================

</code></pre>
</div>
<div class="cell-output cell-output-error">
<pre><code>XlaRuntimeError: RESOURCE_EXHAUSTED: Out of memory while trying to allocate 1024128004 bytes.
BufferAssignment OOM Debugging.
BufferAssignment stats:
             parameter allocation:    1.91GiB
              constant allocation:         0B
        maybe_live_out allocation:  976.68MiB
     preallocated temp allocation:         0B
                 total allocation:    2.86GiB
              total fragmentation:         0B (0.00%)
Peak buffers:
    Buffer 1:
        Size: 976.68MiB
        Entry Parameter Subshape: f32[16001,16001]
        ==========================

    Buffer 2:
        Size: 976.68MiB
        Entry Parameter Subshape: f32[16001,16001]
        ==========================

    Buffer 3:
        Size: 976.68MiB
        Operator: op_name="jit(fn)/jit(main)/add" source_file="/home/piriac/Pumberton/Workshop/21-SUMRY-Curvature/diffusion_curvature/diffusion_curvature/graphs.py" source_line=131
        XLA Label: fusion
        Shape: f32[16001,16001]
        ==========================
</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ds <span class="op">=</span> [<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>planes <span class="op">=</span> [plane(<span class="dv">1000</span><span class="op">*</span><span class="dv">2</span><span class="op">**</span>(d<span class="op">-</span><span class="dv">2</span>), d) <span class="cf">for</span> d <span class="kw">in</span> ds]</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i, d <span class="kw">in</span> <span class="bu">enumerate</span>(ds):</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    G <span class="op">=</span> get_adaptive_graph(planes[i]) <span class="co">#get_alpha_decay_graph(planes[i], decay=None, knn=15, anisotropy=1, )</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    DC <span class="op">=</span> DiffusionCurvature(laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,points_per_cluster<span class="op">=</span><span class="va">None</span>,comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>, flattening_method<span class="op">=</span><span class="st">"Fixed"</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    ks <span class="op">=</span> DC.curvature(G, t<span class="op">=</span><span class="dv">8</span>, dim<span class="op">=</span>d, knn<span class="op">=</span><span class="dv">15</span>)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"dimension"</span>,d,<span class="st">": Curvature of Plane is "</span>,ks[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="how-bout-a-donut" class="level2">
<h2 class="anchored" data-anchor-id="how-bout-a-donut">How bout a donut?</h2>
<section id="with-fixed-flattening" class="level3">
<h3 class="anchored" data-anchor-id="with-fixed-flattening">With Fixed Flattening</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>X_torus,ks <span class="op">=</span> torus(<span class="dv">5000</span>,use_guide_points<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>G_torus <span class="op">=</span> get_adaptive_graph(X_torus) <span class="co">#graphtools.Graph(X_torus, anisotropy=1, knn=15, decay=None).to_pygsp()</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> diffusion_matrix_from_affinities(G_torus.W) <span class="co"># is sparse, by default</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>P <span class="op">=</span> jnp.array(P)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>Pt <span class="op">=</span> jax_power_matrix(P,<span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">30</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-grid" class="level3">
<h3 class="anchored" data-anchor-id="with-grid">With Grid</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    use_grid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">25</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-wasserstein" class="level3">
<h3 class="anchored" data-anchor-id="with-wasserstein">With Wasserstein</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Wasserstein"</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Ollivier"</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">15</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Wasserstein Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-laziness" class="level3">
<h3 class="anchored" data-anchor-id="with-laziness">With Laziness</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Laziness"</span>,</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    aperture<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    smoothing <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">30</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>,)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>uks <span class="op">=</span> DC.unsigned_curvature(G_torus,t<span class="op">=</span><span class="dv">30</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,DC.Pt[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,uks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Wasserstein Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-vne-t-selection" class="level3">
<h3 class="anchored" data-anchor-id="with-vne-t-selection">With VNE t selection</h3>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    use_grid<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="va">None</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'scipy.sparse._csr.csr_matrix'&gt;
(1000,)
&lt;class 'scipy.sparse._csr.csr_matrix'&gt;</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>2024-01-03 20:44:48,884:[WARNING](pygsp.graphs.graph.check_weights): The main diagonal of the weight matrix is not 0!</code></pre>
</div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Core_files/figure-html/cell-45-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-neural-flattening" class="level3">
<h3 class="anchored" data-anchor-id="with-neural-flattening">With Neural Flattening</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Neural"</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="dv">100</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">10</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    max_flattening_epochs<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>    use_grid<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">25</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Fixed"</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>ks_torus_at_idx <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">15</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>, idx<span class="op">=</span><span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>ks_torus_at_idx</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>uks <span class="op">=</span> DC.unsigned_curvature(G_torus,t<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>uks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,uks,colorbar<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> enhanced_spectral_clustering(G_torus, uks, dim<span class="op">=</span><span class="dv">2</span>, num_clusters<span class="op">=</span><span class="dv">9</span>, )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>entropy_of_diffusion(Pt[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>fakePt <span class="op">=</span> jnp.concatenate([Pt[<span class="dv">0</span>], jnp.zeros(<span class="bu">len</span>(Pt[<span class="dv">0</span>]))])</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>entropy_of_diffusion(jnp.concatenate([Pt[<span class="dv">0</span>], jnp.zeros(<span class="bu">len</span>(Pt[<span class="dv">0</span>]))]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>jax.scipy.special.entr(jnp.concatenate([Pt[<span class="dv">0</span>], jnp.zeros(<span class="bu">len</span>(Pt[<span class="dv">0</span>]))]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get num nonzero entries in fakePt</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>jnp.<span class="bu">sum</span>(fakePt<span class="op">&gt;</span><span class="fl">1e-10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>(<span class="op">-</span>jnp.log(<span class="dv">1</span><span class="op">/</span>jnp.<span class="bu">sum</span>(fakePt<span class="op">&gt;</span><span class="fl">1e-10</span>, axis<span class="op">=-</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>jnp.<span class="bu">sum</span>(jax.scipy.special.entr(jnp.ones(<span class="dv">10</span>)<span class="op">/</span><span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="with-mean-flattening" class="level3">
<h3 class="anchored" data-anchor-id="with-mean-flattening">With Mean Flattening</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>DC <span class="op">=</span> DiffusionCurvature(</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>    laziness_method<span class="op">=</span><span class="st">"Entropic"</span>,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    flattening_method<span class="op">=</span><span class="st">"Mean Fixed"</span>,</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    comparison_method<span class="op">=</span><span class="st">"Subtraction"</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    points_per_cluster<span class="op">=</span><span class="va">None</span>, <span class="co"># construct separate comparison spaces around each point</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>    comparison_space_size_factor<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>    use_grid<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>ks_torus <span class="op">=</span> DC.curvature(G_torus, t<span class="op">=</span><span class="dv">25</span>, dim<span class="op">=</span><span class="dv">2</span>, knn<span class="op">=</span><span class="dv">15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>plot_3d(X_torus,ks_torus,colorbar<span class="op">=</span><span class="va">True</span>,title<span class="op">=</span><span class="st">'Diffusion Comparison Curvature of the Torus'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>plt.scatter(ks, ks_torus)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Diffusion Curvature vs Real Curvature of Torus"</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Gaussian Curvature"</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Diffusion Curvature"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>nbdev_export</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>